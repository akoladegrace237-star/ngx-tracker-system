<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>NGX Equities Tracker</title>
<link rel="icon" href="https://ngxgroup.com/wp-content/uploads/2019/11/Nigerian-Exchange-Group-Logo-1.png"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root{
    --green:#1a6b3c; --green-light:#e8f5ee; --red:#c0392b; --red-light:#fdf2f2;
    --gold:#f39c12; --gold-light:#fef9ec; --bg:#f0f2f5; --card:#fff;
    --text:#1a1a2e; --muted:#6c757d; --border:#e8eaed;
    --radius:14px; --shadow:0 2px 16px rgba(0,0,0,.07);
    --header-h:60px; --nav-h:56px;
  }
  *{box-sizing:border-box; margin:0; padding:0;}
  html{scroll-behavior:smooth;}
  body{
    font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
    background:var(--bg); color:var(--text);
    padding-top:var(--header-h);
    padding-bottom:calc(var(--nav-h) + env(safe-area-inset-bottom, 0px));
  }

  /* ── Sticky header ── */
  .top-bar{
    position:fixed; top:0; left:0; right:0; z-index:100;
    height:var(--header-h);
    background:linear-gradient(135deg,#1a3a2a 0%,#1a6b3c 100%);
    color:#fff; display:flex; align-items:center;
    padding:0 16px; gap:10px;
    box-shadow:0 2px 12px rgba(0,0,0,.25);
  }
  .top-bar img{height:30px; flex-shrink:0;}
  .top-bar-text{flex:1; min-width:0;}
  .top-bar-text h1{font-size:1rem; font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
  .top-bar-text p{font-size:.7rem; opacity:.75; margin-top:1px;}
  .top-bar-badge{
    background:rgba(255,255,255,.18); border-radius:20px;
    padding:4px 10px; font-size:.68rem; white-space:nowrap; flex-shrink:0;
  }

  /* ── Bottom nav ── */
  .bottom-nav{
    position:fixed; bottom:0; left:0; right:0; z-index:100;
    height:var(--nav-h);
    background:#fff; border-top:1px solid var(--border);
    display:flex; align-items:stretch;
    padding-bottom:env(safe-area-inset-bottom, 0px);
    box-shadow:0 -2px 12px rgba(0,0,0,.08);
  }
  .bottom-nav a{
    flex:1; display:flex; flex-direction:column; align-items:center;
    justify-content:center; text-decoration:none; color:var(--muted);
    font-size:.62rem; font-weight:600; letter-spacing:.3px; gap:3px;
    transition:color .15s;
    -webkit-tap-highlight-color:transparent;
  }
  .bottom-nav a:active{color:var(--green); background:var(--green-light);}
  .bottom-nav a span.icon{font-size:1.25rem; line-height:1;}

  /* ── Layout ── */
  .container{max-width:1100px; margin:0 auto; padding:12px 12px 0;}

  /* ── Section title ── */
  .section-title{
    font-size:1rem; font-weight:700; color:var(--text);
    margin:20px 0 10px; padding:10px 12px;
    border-left:4px solid var(--green);
    background:var(--card); border-radius:0 var(--radius) var(--radius) 0;
    box-shadow:var(--shadow);
  }

  /* ── KPI row ── */
  .kpi-grid{display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:4px;}
  @media(min-width:600px){.kpi-grid{grid-template-columns:repeat(6,1fr);}}
  .kpi{
    background:var(--card); border-radius:var(--radius); padding:12px 6px;
    text-align:center; box-shadow:var(--shadow);
  }
  .kpi .val{font-size:1.3rem; font-weight:800; line-height:1;}
  .kpi .lbl{font-size:.62rem; color:var(--muted); margin-top:4px;
    text-transform:uppercase; letter-spacing:.4px; line-height:1.2;}
  .kpi.green .val{color:var(--green);}
  .kpi.red   .val{color:var(--red);}
  .kpi.gold  .val{color:var(--gold);}

  /* -- Tooltip -- */
  .kpi[data-tip]{position:relative; cursor:help;}
  .kpi[data-tip]::after{
    content:attr(data-tip);
    position:absolute; bottom:calc(100% + 7px); left:50%; transform:translateX(-50%);
    background:rgba(30,30,30,.92); color:#fff; font-size:.66rem; font-weight:400;
    padding:7px 10px; border-radius:7px; white-space:normal; max-width:170px;
    text-align:center; line-height:1.45; z-index:100; pointer-events:none;
    opacity:0; transition:opacity .18s; box-shadow:0 2px 10px rgba(0,0,0,.25);
    letter-spacing:0; text-transform:none;
  }
  .kpi[data-tip]:hover::after,
  .kpi[data-tip].tip-open::after{opacity:1;}

  /* ── Two-column grid ── */
  .two-col{display:grid; grid-template-columns:1fr; gap:12px;}
  @media(min-width:768px){.two-col{grid-template-columns:1fr 1fr;}}

  /* ── Card ── */
  .card{background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden;}
  .card-header{
    padding:12px 14px; font-weight:700; font-size:.9rem;
    display:flex; align-items:center; gap:8px;
  }
  .card-header.green{background:var(--green-light); color:var(--green);}
  .card-header.red  {background:var(--red-light);   color:var(--red);}
  .card-body{padding:10px 12px;}
  canvas{max-height:200px; width:100% !important;}

  /* ── Scrollable table wrapper ── */
  .table-wrap{overflow-x:auto; -webkit-overflow-scrolling:touch; margin-top:10px;}
  table{width:100%; border-collapse:collapse; font-size:.8rem; min-width:300px;}
  th{
    background:#f1f3f5; color:var(--muted); font-weight:600; white-space:nowrap;
    text-align:right; padding:8px 10px; font-size:.68rem; text-transform:uppercase;
    position:sticky; top:0;
  }
  th:first-child{text-align:left;}
  td{padding:8px 10px; border-bottom:1px solid #f0f0f0; text-align:right; white-space:nowrap;}
  td:first-child{text-align:left; font-weight:700; max-width:120px; overflow:hidden; text-overflow:ellipsis;}
  tr:last-child td{border-bottom:none;}
  tr:active td{background:#f8f9fa;}
  .up {color:var(--green); font-weight:700;}
  .dn {color:var(--red);   font-weight:700;}
  .neu{color:var(--muted);}

  /* ── Hide less important table cols on small screens ── */
  @media(max-width:480px){
    .hide-mobile{display:none;}
  }

  /* -- Collapsible card -- */
  .card-header{cursor:pointer; user-select:none; -webkit-tap-highlight-color:transparent;}
  .card-header .arrow{margin-left:auto; font-size:.85rem; transition:transform .25s; display:inline-block;}
  .card-body.collapsed{display:none;}

  /* ── Portfolio cards ── */
  .port-grid{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:8px;}
  @media(min-width:540px){.port-grid{grid-template-columns:repeat(3,1fr);}}
  @media(min-width:900px){.port-grid{grid-template-columns:repeat(4,1fr);}}
  .port-card{
    background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:14px 10px; text-align:center; border-top:4px solid var(--green);
  }
  .port-sym  {font-size:.9rem; font-weight:800; margin-bottom:2px; word-break:break-all;}
  .port-price{font-size:1.4rem; font-weight:800; margin:5px 0;}
  .port-chg  {font-size:.85rem; font-weight:700; margin-bottom:8px;}
  .port-row  {font-size:.7rem; color:var(--muted); margin:3px 0; line-height:1.3;}
  .port-row b{color:var(--text);}
  .port-signal{
    display:inline-block; margin-top:8px; padding:5px 12px;
    border-radius:20px; font-size:.72rem; font-weight:700; color:#fff;
  }
  .port-signal.sell    {background:#c0392b;}
  .port-signal.consider{background:#e67e22;}
  .port-signal.watch   {background:#f39c12; color:#333;}
  .port-signal.hold    {background:#7f8c8d;}
  .port-signal.keep    {background:#1a6b3c;}
  .port-reason{font-size:.65rem; color:var(--muted); margin-top:5px; line-height:1.4; font-style:italic;}

  /* ── Stop-loss alert banner ── */
  .stop-loss-alert{
    background:#fdf2f2; border:1px solid #c0392b; border-radius:8px;
    padding:6px 10px; margin-top:8px; font-size:.68rem;
    color:#c0392b; font-weight:700;
  }
  .stop-loss-warn{
    background:#fef9ec; border:1px solid #f39c12; border-radius:8px;
    padding:6px 10px; margin-top:8px; font-size:.68rem;
    color:#e67e22; font-weight:700;
  }

  /* ── Rec cards ── */
  .rec-grid{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
  @media(min-width:600px){.rec-grid{grid-template-columns:repeat(3,1fr);}}
  @media(min-width:900px){.rec-grid{grid-template-columns:repeat(5,1fr);}}
  .rec-card{
    background:var(--card); border-radius:var(--radius);
    box-shadow:var(--shadow); padding:14px 10px; text-align:center;
    border-top:4px solid var(--green);
  }
  .rec-card.watch{border-top-color:var(--gold);}
  .rec-sym  {font-size:.9rem; font-weight:800; margin-bottom:4px; word-break:break-all;}
  .rec-price{font-size:1.3rem; font-weight:800; color:var(--green); margin:4px 0;}
  .rec-price.dn{color:var(--red);}
  .rec-pct  {font-size:.85rem; margin-bottom:6px;}
  .rec-row  {font-size:.7rem; color:var(--muted); margin:3px 0;}
  .rec-row b{color:var(--text);}
  .signal{
    display:inline-block; margin-top:8px; padding:4px 12px;
    border-radius:20px; font-size:.72rem; font-weight:700;
    background:var(--green); color:#fff;
  }
  .signal.watch{background:var(--gold); color:#333;}

  /* ── Score guide ── */
  .score-guide{
    font-size:.72rem; color:var(--muted); margin-top:12px;
    background:var(--card); border-radius:var(--radius);
    padding:10px 14px; box-shadow:var(--shadow); line-height:1.8;
  }

  /* ── All Stocks table ── */
  .all-stocks-toolbar{
    display:flex; gap:8px; margin-bottom:10px; flex-wrap:wrap; align-items:center;
  }
  .all-stocks-toolbar input{
    flex:1; min-width:160px; padding:8px 12px; border:1px solid var(--border);
    border-radius:8px; font-size:.82rem; outline:none;
  }
  .all-stocks-toolbar select{
    padding:8px 10px; border:1px solid var(--border);
    border-radius:8px; font-size:.82rem; outline:none; background:#fff;
  }
  .all-stocks-toolbar .stock-count{
    font-size:.75rem; color:var(--muted); white-space:nowrap;
  }
  #allStocksTable th{cursor:pointer; user-select:none;}
  #allStocksTable th:hover{background:#e8eaed;}
  .rank-badge{
    display:inline-block; width:22px; height:22px; border-radius:50%;
    background:var(--green); color:#fff; font-size:.65rem;
    font-weight:800; line-height:22px; text-align:center;
  }
  .rank-badge.top3{background:var(--gold); color:#333;}
  .rank-badge.bot3{background:var(--red);}

  /* ── Footer ── */
  footer{
    text-align:center; color:var(--muted); font-size:.72rem;
    margin-top:24px; padding:16px;
  }
  footer a{color:var(--green); text-decoration:none;}
</style>
</head>
<body>

<!-- Sticky top bar -->
<div class="top-bar">
  <img src="https://ngxgroup.com/wp-content/uploads/2019/11/Nigerian-Exchange-Group-Logo-1.png" alt="NGX"/>
  <div class="top-bar-text">
    <h1>NGX Equities Tracker</h1>
    <p>Nigerian Exchange — Live Intelligence</p>
  </div>
  <div class="top-bar-badge">&#128336; 25 Feb 2026, 13:58 WAT</div>
</div>

<div class="container">

  <!-- KPIs -->
  <div id="overview" style="scroll-margin-top:70px;">
    <div class="section-title">&#128200; Market Overview</div>
    <div class="kpi-grid">
      <div class="kpi" data-tip="Total NGX equities tracked in today's session"><div class="val">148</div><div class="lbl">Total<br/>Stocks</div></div>
      <div class="kpi green" data-tip="Stocks that closed HIGHER than their previous close"><div class="val">22</div><div class="lbl">Advancing<br/>&#9650;</div></div>
      <div class="kpi red"   data-tip="Stocks that closed LOWER than their previous close"><div class="val">52</div><div class="lbl">Declining<br/>&#9660;</div></div>
      <div class="kpi"       data-tip="Stocks whose price did not move from the previous close"><div class="val">74</div><div class="lbl">Unchanged<br/>&#8212;</div></div>
      <div class="kpi red" data-tip="Average % price change across all stocks today"><div class="val">-1.28%</div><div class="lbl">Avg<br/>Change</div></div>
      <div class="kpi gold"  data-tip="Hourly snapshots used for trend signals (~1 per trading hour, max 168 = 7 days)"><div class="val">49</div><div class="lbl">History<br/>Snaps</div></div>
    </div>
  </div>

  <!-- My Portfolio -->
  <div id="portfolio" style="scroll-margin-top:70px;">
    <div class="section-title">&#128202; My Portfolio</div>
    <div class="port-grid" id="portGrid"></div>
  </div>

  <!-- Gainers & Losers -->
  <div id="markets" style="scroll-margin-top:70px;">
    <div class="section-title">&#128200; Top Movers</div>
    <div class="two-col">

      <div class="card">
        <div class="card-header green" onclick="toggleCard('gainBody_wrap','gainArrow')">&#129001; Top 10 Gainers <span class="arrow" id="gainArrow">&#9660;</span></div>
        <div class="card-body" id="gainBody_wrap">
          <canvas id="gainChart"></canvas>
          <div class="table-wrap">
            <table>
              <thead><tr>
                <th>Symbol</th>
                <th class="hide-mobile">Prev &#8358;</th>
                <th>Close &#8358;</th>
                <th class="hide-mobile">Chg</th>
                <th>% Chg</th>
              </tr></thead>
              <tbody id="gainBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header red" onclick="toggleCard('lossBody_wrap','lossArrow')">&#128308; Top 10 Losers <span class="arrow" id="lossArrow">&#9660;</span></div>
        <div class="card-body" id="lossBody_wrap">
          <canvas id="lossChart"></canvas>
          <div class="table-wrap">
            <table>
              <thead><tr>
                <th>Symbol</th>
                <th class="hide-mobile">Prev &#8358;</th>
                <th>Close &#8358;</th>
                <th class="hide-mobile">Chg</th>
                <th>% Chg</th>
              </tr></thead>
              <tbody id="lossBody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Recommendations -->
  <div id="recs" style="scroll-margin-top:70px;">
    <div class="section-title">&#128161; Buy Recommendations</div>
    <p style="font-size:.75rem;color:var(--muted);margin-bottom:10px;padding:0 4px;">Trend analysis based on 49 hourly snapshot(s). More snapshots improve signal accuracy.</p>
    <div class="rec-grid" id="recGrid"></div>
    <div class="score-guide">
      <b>Signal guide:</b> STRONG BUY &#8805;30pts &nbsp;&#183;&nbsp; BUY &#8805;15pts &nbsp;&#183;&nbsp; WATCH &#8805;5pts<br/>
      <b>Factors:</b> Momentum (40%) &middot; Consistency (20%) &middot; Volume (10%) &middot; Recent trend (30%); &minus;15pts for 3 down-sessions in a row
    </div>
  </div>

  <!-- All Stocks -->
  <div id="allstocks" style="scroll-margin-top:70px;">
    <div class="section-title">&#128196; All NGX Stocks — Ranked by Performance</div>
    <div class="all-stocks-toolbar">
      <input type="text" id="stockSearch" placeholder="&#128269; Search company name..." oninput="filterStocks()"/>
      <select id="sortCol" onchange="sortStocks()">
        <option value="rank">Rank (% Change)</option>
        <option value="name">Name A–Z</option>
        <option value="close">Close Price</option>
        <option value="volume">Volume</option>
      </select>
      <span class="stock-count" id="stockCount"></span>
    </div>
    <div class="card">
      <div class="table-wrap">
        <table id="allStocksTable">
          <thead><tr>
            <th onclick="sortByCol('rank')">#</th>
            <th onclick="sortByCol('name')" style="text-align:left">Company</th>
            <th onclick="sortByCol('close')">Close &#8358;</th>
            <th onclick="sortByCol('pct')">% Chg</th>
            <th onclick="sortByCol('change')" class="hide-mobile">Chg &#8358;</th>
            <th onclick="sortByCol('high')" class="hide-mobile">High</th>
            <th onclick="sortByCol('low')" class="hide-mobile">Low</th>
            <th onclick="sortByCol('volume')">Volume</th>
          </tr></thead>
          <tbody id="allStocksBody"></tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<footer>
  <p>Data from <a href="https://ngxgroup.com/exchange/data/equities-price-list/" target="_blank">ngxgroup.com</a> &middot; Prices delayed ~30 min</p>
  <p style="margin-top:4px;">Auto-refreshed hourly via GitHub Actions</p>
</footer>

<!-- Bottom nav -->
<nav class="bottom-nav">
  <a href="#overview"><span class="icon">&#128200;</span>Overview</a>
  <a href="#portfolio"><span class="icon">&#128202;</span>Portfolio</a>
  <a href="#markets"><span class="icon">&#128308;</span>Movers</a>
  <a href="#recs"><span class="icon">&#128161;</span>Picks</a>
  <a href="#allstocks"><span class="icon">&#128196;</span>All</a>
</nav>

<script>
function toggleCard(bodyId, arrowId) {
  const body  = document.getElementById(bodyId);
  const arrow = document.getElementById(arrowId);
  const isNowCollapsed = body.classList.toggle('collapsed');
  arrow.style.transform = isNowCollapsed ? 'rotate(-90deg)' : 'rotate(0deg)';
}

const GAINERS     = [{"Company": "JAIZBANK", "Prev_Close": 12.76, "Close": 14.03, "Change": 1.27, "Pct_Change": 9.95, "Volume": 44814909.0, "Value": 612095830.18}, {"Company": "OKOMUOIL", "Prev_Close": 1605.6, "Close": 1765.0, "Change": 159.4, "Pct_Change": 9.93, "Volume": 1221480.0, "Value": 2138538145.3}, {"Company": "TRANSEXPR", "Prev_Close": 2.15, "Close": 2.36, "Change": 0.21, "Pct_Change": 9.77, "Volume": 2479686.0, "Value": 5852058.96}, {"Company": "FTGINSURE [DWL]", "Prev_Close": 0.72, "Close": 0.79, "Change": 0.07, "Pct_Change": 9.72, "Volume": 193692277.0, "Value": 152659880.88}, {"Company": "CHAMPION [BLS]", "Prev_Close": 16.7, "Close": 17.6, "Change": 0.9, "Pct_Change": 5.39, "Volume": 2630801.0, "Value": 45238303.45}, {"Company": "AFRIPRUD", "Prev_Close": 18.0, "Close": 18.9, "Change": 0.9, "Pct_Change": 5.0, "Volume": 6518354.0, "Value": 118170180.75}, {"Company": "STERLINGNG", "Prev_Close": 8.6, "Close": 9.0, "Change": 0.4, "Pct_Change": 4.65, "Volume": 49019155.0, "Value": 436761485.75}, {"Company": "ELLAHLAKES", "Prev_Close": 10.4, "Close": 10.8, "Change": 0.4, "Pct_Change": 3.85, "Volume": 98149201.0, "Value": 996790545.25}, {"Company": "BUAFOODS", "Prev_Close": 760.6, "Close": 787.0, "Change": 26.4, "Pct_Change": 3.47, "Volume": 478164.0, "Value": 374227984.3}, {"Company": "DANGSUGAR", "Prev_Close": 81.15, "Close": 83.95, "Change": 2.8, "Pct_Change": 3.45, "Volume": 9909956.0, "Value": 812200976.5}];
const LOSERS      = [{"Company": "ABCTRANS", "Prev_Close": 7.5, "Close": 6.75, "Change": -0.75, "Pct_Change": -10.0, "Volume": 1803594.0, "Value": 12174259.5}, {"Company": "RTBRISCOE", "Prev_Close": 11.5, "Close": 10.35, "Change": -1.15, "Pct_Change": -10.0, "Volume": 5232129.0, "Value": 54221820.84}, {"Company": "SKYAVN", "Prev_Close": 154.8, "Close": 139.35, "Change": -15.45, "Pct_Change": -9.98, "Volume": 502599.0, "Value": 70148012.05}, {"Company": "HMCALL", "Prev_Close": 4.43, "Close": 3.99, "Change": -0.44, "Pct_Change": -9.93, "Volume": 1028960.0, "Value": 4156444.13}, {"Company": "UNIONDICON [DWL]", "Prev_Close": 18.4, "Close": 16.6, "Change": -1.8, "Pct_Change": -9.78, "Volume": 1434051.0, "Value": 23805246.6}, {"Company": "NGXGROUP", "Prev_Close": 122.0, "Close": 110.1, "Change": -11.9, "Pct_Change": -9.75, "Volume": 1887160.0, "Value": 210492237.45}, {"Company": "CORNERST", "Prev_Close": 6.48, "Close": 5.85, "Change": -0.63, "Pct_Change": -9.72, "Volume": 7895776.0, "Value": 50149619.18}, {"Company": "CUSTODIAN", "Prev_Close": 73.3, "Close": 66.2, "Change": -7.1, "Pct_Change": -9.69, "Volume": 1287388.0, "Value": 86808744.0}, {"Company": "ABBEYBDS", "Prev_Close": 11.4, "Close": 10.3, "Change": -1.1, "Pct_Change": -9.65, "Volume": 539729.0, "Value": 5581117.85}, {"Company": "OMATEK", "Prev_Close": 2.39, "Close": 2.16, "Change": -0.23, "Pct_Change": -9.62, "Volume": 7916324.0, "Value": 17663408.02}];
const RECS        = [{"Company": "UHOMREIT", "Score": 127.38, "momentum_%": 0.0, "consistency": 0.0, "volume_trend_%": 765.34, "recent_momentum_%": 474.59, "consecutive_declines": 3.0, "total_score": 127.38, "Close": 69.25, "Pct_Change": -0.07, "Volume": 194225.0, "Recommendation": "STRONG BUY"}, {"Company": "UNIONDICON [DWL]", "Score": 110.63, "momentum_%": 0.0, "consistency": 0.0, "volume_trend_%": 287.35, "recent_momentum_%": 418.75, "consecutive_declines": 3.0, "total_score": 110.63, "Close": 16.6, "Pct_Change": -9.78, "Volume": 1434051.0, "Recommendation": "STRONG BUY"}, {"Company": "ETERNA [MRF]", "Score": 82.05, "momentum_%": 0.0, "consistency": 0.24, "volume_trend_%": 328.23, "recent_momentum_%": 257.19, "consecutive_declines": null, "total_score": 82.05, "Close": 32.9, "Pct_Change": 1.23, "Volume": 519142.0, "Recommendation": "STRONG BUY"}, {"Company": "INTENEGINS", "Score": 71.55, "momentum_%": 0.0, "consistency": 0.0, "volume_trend_%": 63.62, "recent_momentum_%": 288.5, "consecutive_declines": 3.0, "total_score": 71.55, "Close": 3.15, "Pct_Change": -7.35, "Volume": 573983.0, "Recommendation": "STRONG BUY"}, {"Company": "TRANSEXPR", "Score": 70.67, "momentum_%": 0.0, "consistency": 0.2, "volume_trend_%": 41228.1, "recent_momentum_%": 221.95, "consecutive_declines": null, "total_score": 70.67, "Close": 2.36, "Pct_Change": 9.77, "Volume": 2479686.0, "Recommendation": "STRONG BUY"}];
const PORTFOLIO   = [{"Company": "AFRIPRUD", "Prev_Close": 18.0, "Opening_Price": 18.0, "High": 19.25, "Low": 17.5, "Close": 18.9, "Change": 0.9, "Trades": 373.0, "Volume": 6518354.0, "Value": 118170180.75, "Trade_Date": "25 Feb 26", "Pct_Change": 5.0, "Fetched_At": "2026-02-25 13:58:02", "_qty": 13200, "_buy_price": 15.0, "_stop_loss_pct": 10}, {"Company": "UNIVINSURE", "Prev_Close": 1.45, "Opening_Price": 1.45, "High": 1.48, "Low": 1.39, "Close": 1.39, "Change": -0.06, "Trades": 289.0, "Volume": 28236555.0, "Value": 39927565.76, "Trade_Date": "25 Feb 26", "Pct_Change": -4.14, "Fetched_At": "2026-02-25 13:58:02", "_qty": 542000, "_buy_price": 1.1, "_stop_loss_pct": 8}, {"Company": "CUTIX", "Prev_Close": 3.88, "Opening_Price": 3.88, "High": 3.78, "Low": 3.65, "Close": 3.66, "Change": -0.22, "Trades": 350.0, "Volume": 5972381.0, "Value": 22244120.27, "Trade_Date": "25 Feb 26", "Pct_Change": -5.67, "Fetched_At": "2026-02-25 13:58:02", "_qty": 185000, "_buy_price": 2.6, "_stop_loss_pct": 10}, {"Company": "SOVRENINS [MRF]", "Prev_Close": 2.3, "Opening_Price": 2.3, "High": 2.33, "Low": 2.08, "Close": 2.08, "Change": -0.22, "Trades": 194.0, "Volume": 17161595.0, "Value": 38170183.5, "Trade_Date": "25 Feb 26", "Pct_Change": -9.57, "Fetched_At": "2026-02-25 13:58:02", "_qty": 200000, "_buy_price": 1.0, "_stop_loss_pct": 12}];
const PORT_MISS   = [];
const PORT_SIGNALS = {"AFRIPRUD": {"signal": "KEEP", "reason": "Up 19.2% over 49 sessions — strong trend", "net_change_pct": 19.24, "recent_avg_pct": 1.85, "consec_down": 0, "sessions": 49, "week_change_pct": 19.24, "three_day_change_pct": 19.24}, "UNIVINSURE": {"signal": "CONSIDER SELLING", "reason": "6 consecutive declining sessions — momentum is bearish", "net_change_pct": -2.11, "recent_avg_pct": -3.68, "consec_down": 6, "sessions": 49, "week_change_pct": -2.11, "three_day_change_pct": -2.11}, "CUTIX": {"signal": "CONSIDER SELLING", "reason": "Down 6.9% overall; recent avg -3.8%/session", "net_change_pct": -6.87, "recent_avg_pct": -3.78, "consec_down": 10, "sessions": 49, "week_change_pct": -6.87, "three_day_change_pct": -6.87}, "SOVRENINS [MRF]": {"signal": "SELL", "reason": "Down 20.0% over 49 sessions with 7 consecutive declines", "net_change_pct": -20.0, "recent_avg_pct": -4.64, "consec_down": 7, "sessions": 49, "week_change_pct": -20.0, "three_day_change_pct": -20.0}};
const ALL_STOCKS  = [{"Company": "JAIZBANK", "Close": 14.03, "Pct_Change": 9.95, "Change": 1.27, "Volume": 44814909.0, "High": 14.03, "Low": 12.88}, {"Company": "OKOMUOIL", "Close": 1765.0, "Pct_Change": 9.93, "Change": 159.4, "Volume": 1221480.0, "High": 1765.0, "Low": 1765.0}, {"Company": "TRANSEXPR", "Close": 2.36, "Pct_Change": 9.77, "Change": 0.21, "Volume": 2479686.0, "High": 2.36, "Low": 2.36}, {"Company": "FTGINSURE [DWL]", "Close": 0.79, "Pct_Change": 9.72, "Change": 0.07, "Volume": 193692277.0, "High": 0.79, "Low": 0.75}, {"Company": "CHAMPION [BLS]", "Close": 17.6, "Pct_Change": 5.39, "Change": 0.9, "Volume": 2630801.0, "High": 17.95, "Low": 16.85}, {"Company": "AFRIPRUD", "Close": 18.9, "Pct_Change": 5.0, "Change": 0.9, "Volume": 6518354.0, "High": 19.25, "Low": 17.5}, {"Company": "STERLINGNG", "Close": 9.0, "Pct_Change": 4.65, "Change": 0.4, "Volume": 49019155.0, "High": 9.35, "Low": 8.65}, {"Company": "ELLAHLAKES", "Close": 10.8, "Pct_Change": 3.85, "Change": 0.4, "Volume": 98149201.0, "High": 11.15, "Low": 9.4}, {"Company": "BUAFOODS", "Close": 787.0, "Pct_Change": 3.47, "Change": 26.4, "Volume": 478164.0, "High": 787.0, "Low": 785.0}, {"Company": "DANGSUGAR", "Close": 83.95, "Pct_Change": 3.45, "Change": 2.8, "Volume": 9909956.0, "High": 84.9, "Low": 81.0}, {"Company": "CILEASING", "Close": 7.55, "Pct_Change": 3.42, "Change": 0.25, "Volume": 5426048.0, "High": 7.55, "Low": 7.3}, {"Company": "LASACO", "Close": 2.49, "Pct_Change": 3.32, "Change": 0.08, "Volume": 20061465.0, "High": 2.54, "Low": 2.41}, {"Company": "CAVERTON", "Close": 6.5, "Pct_Change": 3.17, "Change": 0.2, "Volume": 2365861.0, "High": 6.75, "Low": 6.5}, {"Company": "FCMB", "Close": 13.8, "Pct_Change": 1.85, "Change": 0.25, "Volume": 38181123.0, "High": 14.5, "Low": 12.9}, {"Company": "MANSARD", "Close": 17.3, "Pct_Change": 1.76, "Change": 0.3, "Volume": 3229667.0, "High": 18.7, "Low": 17.3}, {"Company": "WEMABANK", "Close": 27.25, "Pct_Change": 1.49, "Change": 0.4, "Volume": 30784425.0, "High": 27.4, "Low": 26.75}, {"Company": "ETERNA [MRF]", "Close": 32.9, "Pct_Change": 1.23, "Change": 0.4, "Volume": 519142.0, "High": 32.9, "Low": 32.9}, {"Company": "TRANSCORP", "Close": 54.1, "Pct_Change": 1.03, "Change": 0.55, "Volume": 7812443.0, "High": 55.05, "Low": 54.1}, {"Company": "VERITASKAP", "Close": 2.42, "Pct_Change": 0.83, "Change": 0.02, "Volume": 27293880.0, "High": 2.49, "Low": 2.2}, {"Company": "TANTALIZER", "Close": 4.9, "Pct_Change": 0.82, "Change": 0.04, "Volume": 32204119.0, "High": 4.9, "Low": 4.38}, {"Company": "GUINEAINS", "Close": 1.39, "Pct_Change": 0.72, "Change": 0.01, "Volume": 2782075.0, "High": 1.39, "Low": 1.35}, {"Company": "TIP", "Close": 18.6, "Pct_Change": 0.27, "Change": 0.05, "Volume": 4905935.0, "High": 18.65, "Low": 18.6}, {"Company": "VITAFOAM", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 537611.0, "High": 0.0, "Low": 0.0}, {"Company": "ZICHIS", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "VANLEER [DIP]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "BAPLC", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "BUACEMENT", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1460329.0, "High": 0.0, "Low": 0.0}, {"Company": "CAP", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 108769.0, "High": 0.0, "Low": 0.0}, {"Company": "AIRTELAFRI", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 182.0, "High": 0.0, "Low": 0.0}, {"Company": "AUSTINLAZ [RST]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1015741.0, "High": 0.0, "Low": 0.0}, {"Company": "ALEX [MRF]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 42088.0, "High": 0.0, "Low": 0.0}, {"Company": "ARADEL", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 2899402.0, "High": 0.0, "Low": 0.0}, {"Company": "AFRINSURE [MRF]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "BERGER", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 155454.0, "High": 0.0, "Low": 0.0}, {"Company": "AVAIF", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "BETAGLAS", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 174635.0, "High": 0.0, "Low": 0.0}, {"Company": "AFROMEDIA [MRF]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "ACADEMY", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 801272.0, "High": 0.0, "Low": 0.0}, {"Company": "UPL", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 302788.0, "High": 0.0, "Low": 0.0}, {"Company": "UPDCREIT", "Close": 7.75, "Pct_Change": 0.0, "Change": 0.0, "Volume": 6502696.0, "High": 7.75, "Low": 7.5}, {"Company": "EKOCORP [DIP]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "DUNLOP [DIP]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "JOHNHOLT", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 328396.0, "High": 0.0, "Low": 0.0}, {"Company": "JULI", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 91827.0, "High": 0.0, "Low": 0.0}, {"Company": "GOLDBREW [BMF]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "EUNISELL", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 6426.0, "High": 0.0, "Low": 0.0}, {"Company": "GEREGU", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1230.0, "High": 0.0, "Low": 0.0}, {"Company": "FIDELITYBK", "Close": 20.5, "Pct_Change": 0.0, "Change": 0.0, "Volume": 22679371.0, "High": 21.0, "Low": 20.35}, {"Company": "DANGCEM", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 628278.0, "High": 0.0, "Low": 0.0}, {"Company": "DEAPCAP [DWL]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1748100.0, "High": 0.0, "Low": 0.0}, {"Company": "ETI", "Close": 48.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 4293187.0, "High": 48.0, "Low": 47.5}, {"Company": "ENAMELWA", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 5662.0, "High": 0.0, "Low": 0.0}, {"Company": "MORISON", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 271218.0, "High": 0.0, "Low": 0.0}, {"Company": "MTNN", "Close": 760.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 3830416.0, "High": 760.0, "Low": 760.0}, {"Company": "MULTITREX [DWL]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "MULTIVERSE", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 78789.0, "High": 0.0, "Low": 0.0}, {"Company": "MECURE", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 46372.0, "High": 0.0, "Low": 0.0}, {"Company": "MCNICHOLS", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1254669.0, "High": 0.0, "Low": 0.0}, {"Company": "LEGENDINT", "Close": 6.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1144989.0, "High": 6.06, "Low": 6.0}, {"Company": "IKEJAHOTEL", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 96309.0, "High": 0.0, "Low": 0.0}, {"Company": "MAYBAKER", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 731092.0, "High": 0.0, "Low": 0.0}, {"Company": "LIVINGTRUST", "Close": 5.35, "Pct_Change": 0.0, "Change": 0.0, "Volume": 855138.0, "High": 5.35, "Low": 5.35}, {"Company": "MEYER", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 443160.0, "High": 0.0, "Low": 0.0}, {"Company": "MOFIREIF", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "UNITYBNK [MRF]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "UNILEVER", "Close": 90.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 6297375.0, "High": 91.0, "Low": 90.0}, {"Company": "SUNUASSUR [BLS]", "Close": 4.4, "Pct_Change": 0.0, "Change": 0.0, "Volume": 600524.0, "High": 4.4, "Low": 4.4}, {"Company": "STANBIC", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 2207577.0, "High": 0.0, "Low": 0.0}, {"Company": "SFSREIT", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 6042.0, "High": 0.0, "Low": 0.0}, {"Company": "NIDF", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 89035.0, "High": 0.0, "Low": 0.0}, {"Company": "NREIT", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 38093.0, "High": 0.0, "Low": 0.0}, {"Company": "NNFM", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 29181.0, "High": 0.0, "Low": 0.0}, {"Company": "NCR", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 15616.0, "High": 0.0, "Low": 0.0}, {"Company": "NESTLE", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 30162.0, "High": 0.0, "Low": 0.0}, {"Company": "NASCON", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 826607.0, "High": 0.0, "Low": 0.0}, {"Company": "SEPLAT", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 70591.0, "High": 0.0, "Low": 0.0}, {"Company": "GUINNESS", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 211778.0, "High": 0.0, "Low": 0.0}, {"Company": "IMG", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 7148.0, "High": 0.0, "Low": 0.0}, {"Company": "JBERGER", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 449367.0, "High": 0.0, "Low": 0.0}, {"Company": "INFINITY [BLS]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 725395.0, "High": 0.0, "Low": 0.0}, {"Company": "CONOIL", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 84184.0, "High": 0.0, "Low": 0.0}, {"Company": "CNIF", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 11000.0, "High": 0.0, "Low": 0.0}, {"Company": "CWG", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 1418716.0, "High": 0.0, "Low": 0.0}, {"Company": "CHELLARAM", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 43433.0, "High": 0.0, "Low": 0.0}, {"Company": "TRIPPLEG", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 972607.0, "High": 0.0, "Low": 0.0}, {"Company": "SCOA [MRF]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 72180.0, "High": 0.0, "Low": 0.0}, {"Company": "STACO [DWL]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "RONCHESS", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "REDSTAREX", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 44659.0, "High": 0.0, "Low": 0.0}, {"Company": "TRANSPOWER", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 4121523.0, "High": 0.0, "Low": 0.0}, {"Company": "TOTAL", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 34984.0, "High": 0.0, "Low": 0.0}, {"Company": "TRANSCOHOT", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 23958.0, "High": 0.0, "Low": 0.0}, {"Company": "THOMASWY [MRS]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "PRESCO", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 607488.0, "High": 0.0, "Low": 0.0}, {"Company": "PREMPAINTS [RST]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "PHARMDEKO [MRS]", "Close": 0.0, "Pct_Change": 0.0, "Change": 0.0, "Volume": 0.0, "High": 0.0, "Low": 0.0}, {"Company": "UHOMREIT", "Close": 69.25, "Pct_Change": -0.07, "Change": -0.05, "Volume": 194225.0, "High": 69.25, "Low": 69.25}, {"Company": "ROYALEX", "Close": 1.92, "Pct_Change": -0.52, "Change": -0.01, "Volume": 4103991.0, "High": 2.01, "Low": 1.92}, {"Company": "NPFMCRFBK", "Close": 6.22, "Pct_Change": -0.96, "Change": -0.06, "Volume": 4376985.0, "High": 6.22, "Low": 5.67}, {"Company": "INTBREW", "Close": 14.5, "Pct_Change": -1.02, "Change": -0.15, "Volume": 2479027.0, "High": 14.7, "Low": 13.5}, {"Company": "HONYFLOUR", "Close": 23.0, "Pct_Change": -1.08, "Change": -0.25, "Volume": 2880155.0, "High": 23.0, "Low": 22.0}, {"Company": "WAPCO", "Close": 207.0, "Pct_Change": -1.43, "Change": -3.0, "Volume": 3704508.0, "High": 207.0, "Low": 207.0}, {"Company": "ACCESSCORP", "Close": 26.55, "Pct_Change": -1.67, "Change": -0.45, "Volume": 62006800.0, "High": 27.0, "Low": 26.0}, {"Company": "GTCO", "Close": 118.0, "Pct_Change": -1.67, "Change": -2.0, "Volume": 31438209.0, "High": 120.0, "Low": 117.45}, {"Company": "NB", "Close": 80.0, "Pct_Change": -1.84, "Change": -1.5, "Volume": 7106464.0, "High": 80.5, "Low": 80.0}, {"Company": "UPDC [BLS]", "Close": 5.25, "Pct_Change": -1.87, "Change": -0.1, "Volume": 4574106.0, "High": 5.25, "Low": 5.1}, {"Company": "UBA", "Close": 49.2, "Pct_Change": -1.99, "Change": -1.0, "Volume": 50279559.0, "High": 50.3, "Low": 47.8}, {"Company": "UCAP", "Close": 19.3, "Pct_Change": -2.03, "Change": -0.4, "Volume": 15166397.0, "High": 19.8, "Low": 19.3}, {"Company": "ZENITHBANK", "Close": 91.05, "Pct_Change": -2.1, "Change": -1.95, "Volume": 115291203.0, "High": 94.0, "Low": 89.2}, {"Company": "NSLTECH", "Close": 1.38, "Pct_Change": -2.13, "Change": -0.03, "Volume": 14854307.0, "High": 1.5, "Low": 1.28}, {"Company": "CONHALLPLC", "Close": 4.84, "Pct_Change": -2.22, "Change": -0.11, "Volume": 3311574.0, "High": 4.95, "Low": 4.8}, {"Company": "NEIMETH", "Close": 11.7, "Pct_Change": -2.5, "Change": -0.3, "Volume": 2403378.0, "High": 11.95, "Low": 11.7}, {"Company": "PRESTIGE [BLS]", "Close": 1.62, "Pct_Change": -2.99, "Change": -0.05, "Volume": 1163981.0, "High": 1.67, "Low": 1.62}, {"Company": "CADBURY", "Close": 68.6, "Pct_Change": -3.04, "Change": -2.15, "Volume": 1670953.0, "High": 68.6, "Low": 68.6}, {"Company": "MBENEFIT", "Close": 5.01, "Pct_Change": -3.28, "Change": -0.17, "Volume": 24718339.0, "High": 5.15, "Low": 4.67}, {"Company": "PZ", "Close": 71.1, "Pct_Change": -3.85, "Change": -2.85, "Volume": 3631610.0, "High": 71.4, "Low": 70.5}, {"Company": "UNIVINSURE", "Close": 1.39, "Pct_Change": -4.14, "Change": -0.06, "Volume": 28236555.0, "High": 1.48, "Low": 1.39}, {"Company": "LIVESTOCK", "Close": 6.7, "Pct_Change": -4.29, "Change": -0.3, "Volume": 1531529.0, "High": 6.7, "Low": 6.7}, {"Company": "NEM", "Close": 33.5, "Pct_Change": -4.29, "Change": -1.5, "Volume": 759177.0, "High": 33.5, "Low": 33.5}, {"Company": "OANDO", "Close": 40.1, "Pct_Change": -4.3, "Change": -1.8, "Volume": 6082253.0, "High": 41.7, "Low": 40.1}, {"Company": "WAPIC", "Close": 3.45, "Pct_Change": -4.43, "Change": -0.16, "Volume": 3858369.0, "High": 3.6, "Low": 3.32}, {"Company": "DAARCOMM [MRF]", "Close": 2.15, "Pct_Change": -4.44, "Change": -0.1, "Volume": 8034719.0, "High": 2.44, "Low": 2.03}, {"Company": "AIICO", "Close": 4.51, "Pct_Change": -4.65, "Change": -0.22, "Volume": 23141786.0, "High": 4.8, "Low": 4.26}, {"Company": "CHAMS", "Close": 4.15, "Pct_Change": -5.03, "Change": -0.22, "Volume": 19645660.0, "High": 4.25, "Low": 4.0}, {"Company": "UACN", "Close": 100.0, "Pct_Change": -5.62, "Change": -5.95, "Volume": 1234753.0, "High": 100.2, "Low": 100.0}, {"Company": "CUTIX", "Close": 3.66, "Pct_Change": -5.67, "Change": -0.22, "Volume": 5972381.0, "High": 3.78, "Low": 3.65}, {"Company": "NAHCO", "Close": 165.0, "Pct_Change": -5.71, "Change": -10.0, "Volume": 7107272.0, "High": 180.0, "Low": 165.0}, {"Company": "REGALINS", "Close": 1.15, "Pct_Change": -5.74, "Change": -0.07, "Volume": 4573353.0, "High": 1.21, "Low": 1.15}, {"Company": "FIDSON", "Close": 90.0, "Pct_Change": -5.76, "Change": -5.5, "Volume": 1259239.0, "High": 90.0, "Low": 88.35}, {"Company": "LINKASSURE", "Close": 1.69, "Pct_Change": -6.11, "Change": -0.11, "Volume": 46994636.0, "High": 1.82, "Low": 1.69}, {"Company": "INTENEGINS", "Close": 3.15, "Pct_Change": -7.35, "Change": -0.25, "Volume": 573983.0, "High": 3.15, "Low": 3.1}, {"Company": "LEARNAFRCA", "Close": 9.0, "Pct_Change": -8.16, "Change": -0.8, "Volume": 803233.0, "High": 9.0, "Low": 9.0}, {"Company": "JAPAULGOLD", "Close": 3.49, "Pct_Change": -8.16, "Change": -0.31, "Volume": 113805065.0, "High": 3.8, "Low": 3.42}, {"Company": "ETRANZACT", "Close": 21.0, "Pct_Change": -8.3, "Change": -1.9, "Volume": 821398.0, "High": 21.0, "Low": 21.0}, {"Company": "FTNCOCOA [RST]", "Close": 5.5, "Pct_Change": -8.33, "Change": -0.5, "Volume": 4841919.0, "High": 6.0, "Low": 5.45}, {"Company": "FIRSTHOLDCO", "Close": 51.5, "Pct_Change": -8.36, "Change": -4.7, "Volume": 14448667.0, "High": 56.5, "Low": 51.05}, {"Company": "SOVRENINS [MRF]", "Close": 2.08, "Pct_Change": -9.57, "Change": -0.22, "Volume": 17161595.0, "High": 2.33, "Low": 2.08}, {"Company": "VFDGROUP", "Close": 11.3, "Pct_Change": -9.6, "Change": -1.2, "Volume": 4869692.0, "High": 12.3, "Low": 11.3}, {"Company": "OMATEK", "Close": 2.16, "Pct_Change": -9.62, "Change": -0.23, "Volume": 7916324.0, "High": 2.39, "Low": 2.16}, {"Company": "ABBEYBDS", "Close": 10.3, "Pct_Change": -9.65, "Change": -1.1, "Volume": 539729.0, "High": 10.3, "Low": 10.3}, {"Company": "CUSTODIAN", "Close": 66.2, "Pct_Change": -9.69, "Change": -7.1, "Volume": 1287388.0, "High": 68.0, "Low": 66.2}, {"Company": "CORNERST", "Close": 5.85, "Pct_Change": -9.72, "Change": -0.63, "Volume": 7895776.0, "High": 6.4, "Low": 5.85}, {"Company": "NGXGROUP", "Close": 110.1, "Pct_Change": -9.75, "Change": -11.9, "Volume": 1887160.0, "High": 110.1, "Low": 109.8}, {"Company": "UNIONDICON [DWL]", "Close": 16.6, "Pct_Change": -9.78, "Change": -1.8, "Volume": 1434051.0, "High": 16.6, "Low": 16.6}, {"Company": "HMCALL", "Close": 3.99, "Pct_Change": -9.93, "Change": -0.44, "Volume": 1028960.0, "High": 3.99, "Low": 3.99}, {"Company": "SKYAVN", "Close": 139.35, "Pct_Change": -9.98, "Change": -15.45, "Volume": 502599.0, "High": 139.35, "Low": 139.35}, {"Company": "ABCTRANS", "Close": 6.75, "Pct_Change": -10.0, "Change": -0.75, "Volume": 1803594.0, "High": 6.75, "Low": 6.75}, {"Company": "RTBRISCOE", "Close": 10.35, "Pct_Change": -10.0, "Change": -1.15, "Volume": 5232129.0, "High": 10.35, "Low": 10.35}];

// ── Gainers table & chart ──
const gainBody = document.getElementById('gainBody');
GAINERS.forEach((r,i) => {
  gainBody.innerHTML += `<tr>
    <td>${r.Company}</td>
    <td class="hide-mobile">${r.Prev_Close?.toFixed(2) ?? '-'}</td>
    <td>${r.Close?.toFixed(2) ?? '-'}</td>
    <td class="up hide-mobile">+${r.Change?.toFixed(2) ?? '0'}</td>
    <td class="up">+${r.Pct_Change?.toFixed(2) ?? '0'}%</td>
  </tr>`;
});

new Chart(document.getElementById('gainChart'), {
  type:'bar',
  data:{
    labels: GAINERS.map(r=>r.Company),
    datasets:[{ data: GAINERS.map(r=>r.Pct_Change), backgroundColor:'rgba(26,107,60,0.75)', borderRadius:5 }]
  },
  options:{
    plugins:{legend:{display:false}},
    scales:{
      y:{title:{display:true,text:'% Change'},ticks:{font:{size:10}}},
      x:{ticks:{maxRotation:45,font:{size:9}}}
    },
    responsive:true, maintainAspectRatio:true,
  }
});

// ── Losers table & chart ──
const lossBody = document.getElementById('lossBody');
LOSERS.forEach(r => {
  lossBody.innerHTML += `<tr>
    <td>${r.Company}</td>
    <td class="hide-mobile">${r.Prev_Close?.toFixed(2) ?? '-'}</td>
    <td>${r.Close?.toFixed(2) ?? '-'}</td>
    <td class="dn hide-mobile">${r.Change?.toFixed(2) ?? '0'}</td>
    <td class="dn">${r.Pct_Change?.toFixed(2) ?? '0'}%</td>
  </tr>`;
});

new Chart(document.getElementById('lossChart'), {
  type:'bar',
  data:{
    labels: LOSERS.map(r=>r.Company),
    datasets:[{ data: LOSERS.map(r=>r.Pct_Change), backgroundColor:'rgba(192,57,43,0.75)', borderRadius:5 }]
  },
  options:{
    plugins:{legend:{display:false}},
    scales:{
      y:{title:{display:true,text:'% Change'},ticks:{font:{size:10}}},
      x:{ticks:{maxRotation:45,font:{size:9}}}
    },
    responsive:true, maintainAspectRatio:true,
  }
});

// ── My Portfolio cards ──
const portGrid = document.getElementById('portGrid');
if (PORTFOLIO.length === 0 && PORT_MISS.length > 0) {
  portGrid.innerHTML = "<p style='color:var(--muted);font-size:.85rem;'>No portfolio stocks found in today&apos;s data.</p>";
} else {
  PORTFOLIO.forEach(r => {
    const pct       = r.Pct_Change ?? 0;
    const sign      = pct >= 0 ? '+' : '';
    const cls       = pct > 0 ? 'up' : pct < 0 ? 'dn' : 'neu';
    const borderCol = pct > 0 ? 'var(--green)' : pct < 0 ? 'var(--red)' : 'var(--muted)';
    const sig       = PORT_SIGNALS[r.Company] || {};
    const sigText   = sig.signal || 'HOLD';
    const sigReason = sig.reason || '';
    const sigCls    = sigText === 'SELL' ? 'sell'
                    : sigText === 'CONSIDER SELLING' ? 'consider'
                    : sigText === 'WATCH CLOSELY' ? 'watch'
                    : sigText === 'KEEP' ? 'keep' : 'hold';
    const sessions  = sig.sessions ? sig.sessions + ' sessions' : 'today only';
    const netChg    = sig.net_change_pct != null
                    ? (sig.net_change_pct >= 0 ? '+' : '') + sig.net_change_pct.toFixed(2) + '%'
                    : '—';

    // ── P&L block ──
    const qty       = r._qty       || 0;
    const buyPrice  = r._buy_price  || 0;
    const stopLossPct = r._stop_loss_pct || 10;
    let plHtml = '';
    let stopHtml = '';

    if (qty > 0 && buyPrice > 0 && r.Close) {
      const cost   = qty * buyPrice;
      const curVal = qty * r.Close;
      const pl     = curVal - cost;
      const plPct  = (pl / cost * 100);
      const plCls  = pl >= 0 ? 'up' : 'dn';
      const plSign = pl >= 0 ? '+' : '';
      const fmt2   = (n) => n.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2});

      plHtml = `
        <div class="port-row" style="border-top:1px solid #f0f0f0;margin-top:6px;padding-top:6px;">
          Shares: <b>${qty.toLocaleString()}</b>
        </div>
        <div class="port-row">Buy price: <b>&#8358;${buyPrice.toFixed(2)}</b></div>
        <div class="port-row">Cost basis: <b>&#8358;${fmt2(cost)}</b></div>
        <div class="port-row">Market value: <b>&#8358;${fmt2(curVal)}</b></div>
        <div class="port-row ${plCls}">P&amp;L: <b>${plSign}&#8358;${fmt2(Math.abs(pl))} (${plSign}${plPct.toFixed(1)}%)</b></div>`;

      // ── Stop-loss alert ──
      const lossFromBuy = ((r.Close - buyPrice) / buyPrice) * 100;
      const stopLossPrice = buyPrice * (1 - stopLossPct / 100);
      if (lossFromBuy <= -stopLossPct) {
        stopHtml = `<div class="stop-loss-alert">&#128680; STOP-LOSS BREACHED! Down ${Math.abs(lossFromBuy).toFixed(1)}% from buy price. Consider selling.</div>`;
      } else if (lossFromBuy <= -(stopLossPct * 0.7)) {
        stopHtml = `<div class="stop-loss-warn">&#9888; Approaching stop-loss (${stopLossPct}%). Currently ${lossFromBuy.toFixed(1)}% from buy price. Stop at &#8358;${stopLossPrice.toFixed(2)}.</div>`;
      }
    } else if (qty > 0) {
      plHtml = `<div class="port-row" style="border-top:1px solid #f0f0f0;margin-top:6px;padding-top:6px;">Shares held: <b>${qty.toLocaleString()}</b></div>`;
    }

    portGrid.innerHTML += `
      <div class="port-card" style="border-top-color:${borderCol}">
        <div class="port-sym">${r.Company}</div>
        <div class="port-price ${cls}">&#8358;${r.Close?.toFixed(2) ?? '—'}</div>
        <div class="port-chg ${cls}">${sign}${pct.toFixed(2)}% today</div>
        <div class="port-row">High/Low: <b>&#8358;${r.High?.toFixed(2) ?? '—'} / &#8358;${r.Low?.toFixed(2) ?? '—'}</b></div>
        <div class="port-row">Vol: <b>${r.Volume ? r.Volume.toLocaleString() : '—'}</b></div>
        <div class="port-row">Trend (${sessions}): <b>${netChg}</b></div>
        ${plHtml}
        ${stopHtml}
        <div><span class="port-signal ${sigCls}">${sigText}</span></div>
        <div class="port-reason">${sigReason}</div>
      </div>`;
  });
  PORT_MISS.forEach(name => {
    portGrid.innerHTML += `
      <div class="port-card" style="border-top-color:var(--muted);opacity:.5">
        <div class="port-sym">${name}</div>
        <div style="font-size:.75rem;color:var(--muted);margin-top:10px;">Not traded today</div>
      </div>`;
  });
}

// ── Recommendation cards ──
const recGrid = document.getElementById('recGrid');
RECS.forEach(r => {
  const signal   = r.Recommendation || 'WATCH';
  const isBuy    = signal.includes('BUY');
  const pct      = r.Pct_Change ?? 0;
  const mom      = r['momentum_%'] ?? pct;
  const score    = r.Score?.toFixed(1) ?? '—';
  const vol      = r.Volume ? r.Volume.toLocaleString() : '—';
  const sign     = pct >= 0 ? '+' : '';
  const priceClass = pct >= 0 ? '' : 'dn';
  const watchClass = isBuy ? '' : 'watch';
  const sigClass   = isBuy ? '' : 'watch';
  recGrid.innerHTML += `
  <div class="rec-card ${watchClass}">
    <div class="rec-sym">${r.Company}</div>
    <div class="rec-price ${priceClass}">&#8358;${r.Close?.toFixed(2) ?? '—'}</div>
    <div class="rec-pct ${pct>=0?'up':'dn'}">${sign}${pct.toFixed(2)}%</div>
    <div class="rec-row">Score: <b>${score}</b></div>
    <div class="rec-row">Mom: <b>${mom>=0?'+':''}${typeof mom==='number'?mom.toFixed(1):'—'}%</b></div>
    <div class="rec-row">Vol: <b>${vol}</b></div>
    <div><span class="signal ${sigClass}">${signal}</span></div>
  </div>`;
});

// Tap a KPI to show its tooltip on mobile (auto-dismisses after 3s)
document.querySelectorAll(".kpi[data-tip]").forEach(el => {
  el.addEventListener("click", () => {
    el.classList.toggle("tip-open");
    setTimeout(() => el.classList.remove("tip-open"), 3000);
  });
});

// ── All Stocks ranked table ──
let _filteredStocks = [...ALL_STOCKS];
let _sortKey = 'rank';
let _sortAsc = true;

function renderAllStocks() {
  const tbody = document.getElementById('allStocksBody');
  const total = ALL_STOCKS.length;
  tbody.innerHTML = '';
  _filteredStocks.forEach((r, i) => {
    const origRank = ALL_STOCKS.indexOf(r) + 1;
    const pct    = r.Pct_Change ?? 0;
    const sign   = pct >= 0 ? '+' : '';
    const cls    = pct > 0 ? 'up' : pct < 0 ? 'dn' : 'neu';
    const badgeCls = origRank <= 3 ? 'top3' : origRank > total - 3 ? 'bot3' : '';
    tbody.innerHTML += `<tr>
      <td><span class="rank-badge ${badgeCls}">${origRank}</span></td>
      <td style="text-align:left">${r.Company}</td>
      <td>${r.Close?.toFixed(2) ?? '—'}</td>
      <td class="${cls}">${sign}${pct.toFixed(2)}%</td>
      <td class="${cls} hide-mobile">${sign}${r.Change?.toFixed(2) ?? '0'}</td>
      <td class="hide-mobile">${r.High?.toFixed(2) ?? '—'}</td>
      <td class="hide-mobile">${r.Low?.toFixed(2) ?? '—'}</td>
      <td>${r.Volume ? r.Volume.toLocaleString() : '—'}</td>
    </tr>`;
  });
  document.getElementById('stockCount').textContent =
    _filteredStocks.length === total
      ? total + ' stocks'
      : _filteredStocks.length + ' of ' + total + ' stocks';
}

function filterStocks() {
  const q = document.getElementById('stockSearch').value.trim().toUpperCase();
  _filteredStocks = q
    ? ALL_STOCKS.filter(r => r.Company.toUpperCase().includes(q))
    : [...ALL_STOCKS];
  sortStocks(false);
  renderAllStocks();
}

function sortByCol(key) {
  if (_sortKey === key) { _sortAsc = !_sortAsc; }
  else { _sortKey = key; _sortAsc = key === 'rank' || key === 'name'; }
  const keyMap = {
    rank:   r => ALL_STOCKS.indexOf(r),
    name:   r => r.Company,
    close:  r => -(r.Close ?? 0),
    pct:    r => -(r.Pct_Change ?? 0),
    change: r => -(r.Change ?? 0),
    high:   r => -(r.High ?? 0),
    low:    r => -(r.Low ?? 0),
    volume: r => -(r.Volume ?? 0),
  };
  const fn = keyMap[key] || keyMap['rank'];
  _filteredStocks.sort((a, b) => {
    const av = fn(a), bv = fn(b);
    if (av < bv) return _sortAsc ? -1 : 1;
    if (av > bv) return _sortAsc ? 1 : -1;
    return 0;
  });
  renderAllStocks();
}

function sortStocks(doRender = true) {
  const key = document.getElementById('sortCol')?.value || _sortKey;
  const keyMap = {
    rank:   r => ALL_STOCKS.indexOf(r),
    name:   r => r.Company,
    close:  r => -(r.Close ?? 0),
    pct:    r => -(r.Pct_Change ?? 0),
    volume: r => -(r.Volume ?? 0),
  };
  const fn = keyMap[key] || keyMap['rank'];
  _filteredStocks.sort((a, b) => {
    const av = fn(a), bv = fn(b);
    return av < bv ? -1 : av > bv ? 1 : 0;
  });
  if (doRender) renderAllStocks();
}

// Initial render on page load
renderAllStocks();
</script>
</body>
</html>
